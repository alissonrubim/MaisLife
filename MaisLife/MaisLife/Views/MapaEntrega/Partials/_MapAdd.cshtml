@model MaisLife.Models.Adapter.MapaAdapter

@{
    var orders = (List<MaisLife.Models.Adapter.PedidoAdapter>)ViewBag.Orders;
    var today = DateTime.Now;
    DateTime forDate = DateTime.Now;   
}

@using (Ajax.BeginForm("CreateOrEditMap", "MapaEntrega", new AjaxOptions()
        {
            HttpMethod = "POST",
            InsertionMode = InsertionMode.Replace,
            UpdateTargetId = "mapTable"
        }, new { name = "map-data" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.EditorFor(model => model.Id, new { htmlAttributes = new { @class = "form-control", @type = "hidden" } })
    <div class="col-lg-3">
        <div class="form-group">
            <div class="form-label">
                Data:
            </div>
            <div class="form-input">
                @Html.EditorFor(model => model.DataEntrega, new { htmlAttributes = new { @class = "form-control", @placeholder = "Data", @type = "date" } })
            </div>
        </div>
    </div>
    <div class="col-lg-12" style="float: left;">
        <div class="form-group">
            <div class="form-label">
                Observação:
            </div>
            <div class="form-input">
                @Html.TextAreaFor(model => model.Observacao, new { rows = 5, columns = 40, @class = "form-control", @style = "width: 100%;" })
            </div>
        </div>
    </div>
}

<div class="order-box" id="order-box">
    <div class="order-selected">

    </div>
    <div class="order-unselected">
        @foreach (var order in orders)
        {
            if (order.PrevisaoEntrega != forDate)
            {
                <div style="clear: both; margin: 5px 0; border-top: 1px solid #ccc;">
                    <h3>
                        <small>
                            Entrega: <span style="font-weight: bold; color: #333;">@order.PrevisaoEntrega.ToString("dd / MM")</span>
                            @if (@order.PrevisaoEntrega < today)
                            {
                                <span style="font-weight: bold; color: #ce4949;">ATRASADO</span>
                            }
                        </small>
                    </h3>
                </div>
                            forDate = order.PrevisaoEntrega;
            }
            <div class="col-lg-4">
                <div class="order-content" data-content="order-box" data-info="unselected" data-id="@order.Id">
                    <div class="order-header">
                        <div class="order-header-client">
                            @if (@order.Origem == "Vendedor")
                            {
                                @order.UsuarioExterno.Nome
                            }
                            else
                            {
                                @order.Usuario.Nome
                            }
                        </div>
                        <div class="order-header-value">
                            @order.Valor
                        </div>
                    </div>
                    <div class="order-body">
                        <div class="order-deliveryDate">
                            <span>
                                Pedido feito em:
                                @{
                                    <span style="font-weight: bold; float: right;">
                                        @order.Data.ToString("dd/MM/yyyy")
                                    </span>
                                }
                            </span>
                        </div>
                    </div>
                    <div class="order-footer">
                        <div class="order-seller">
                            <span>
                                Colaborador/PDV:
                                @if (@order.Origem == "Vendedor")
                                {
                                    <span style="font-weight: bold; float: right;">
                                        @order.Usuario.Nome
                                    </span>
                                }
                                else
                                {
                                    <span style="font-weight: bold; float: right;">
                                        Site
                                    </span>
                                }
                            </span>
                        </div>
                    </div>
                </div>

            </div>
        }
    </div>
</div>
<div class="add-footer">
    <button type="button" class="btn btn-success" data-id="map-submit">Adicionar itens ao novo mapa</button>
</div>
